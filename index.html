<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/197/197593.png">
    <title>İspanyolca Kartlar</title>
    <style>
        :root {
            --bg: #F2F2F7;
            --card: #FFFFFF;
            --accent: #007AFF;
            --text: #1C1C1E;
            --gray: #8E8E93;
        }

        body {
            font-family: -apple-system, system-ui, sans-serif;
            background-color: var(--bg);
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
            color: var(--text);
        }

        /* Arama Alanı */
        header {
            background: rgba(255,255,255,0.8);
            backdrop-filter: blur(20px);
            padding: calc(env(safe-area-inset-top) + 10px) 15px 15px;
            border-bottom: 0.5px solid #C6C6C8;
        }

        .search-box {
            background: #E3E3E6;
            border-radius: 12px;
            padding: 8px 12px;
            display: flex;
            align-items: center;
        }

        #verbSearch {
            border: none; background: none; width: 100%; font-size: 17px; outline: none;
        }

        /* Kart Alanı */
        main {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .flashcard {
            background: var(--card);
            width: 100%;
            max-width: 400px;
            border-radius: 24px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 25px;
            text-align: center;
            position: relative;
        }

        .verb-title { font-size: 34px; font-weight: 800; margin: 0; }
        .verb-tr { font-size: 18px; color: var(--gray); margin-bottom: 20px; }

        /* Zaman Seçici (Segmented Control) */
        .tense-picker {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            background: #E3E3E6;
            border-radius: 10px;
            padding: 2px;
            margin-bottom: 25px;
        }

        .tense-btn {
            border: none; background: none; padding: 6px 0; font-size: 12px;
            font-weight: 600; border-radius: 8px; cursor: pointer;
        }

        .tense-btn.active {
            background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* Çekim Tablosu */
        .conjugation-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 25px;
        }

        .conj-item {
            background: #F8F8FA;
            padding: 10px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
        }

        .pronoun { font-size: 10px; color: var(--accent); font-weight: 700; text-transform: uppercase; }
        .form { font-size: 16px; font-weight: 600; }
        .form-tr { font-size: 11px; color: var(--gray); }

        /* Örnek Butonu */
        .ex-toggle {
            background: var(--accent);
            color: white; border: none; padding: 12px 20px;
            border-radius: 14px; font-weight: 600; width: 100%;
        }

        /* Örnekler Paneli Overlay */
        #exOverlay {
            position: fixed; bottom: 0; left: 0; right: 0; top: 0;
            background: rgba(0,0,0,0.5); display: none; z-index: 1000;
        }

        .ex-sheet {
            position: absolute; bottom: 0; left: 0; right: 0;
            background: white; border-radius: 20px 20px 0 0;
            padding: 30px 20px; max-height: 70vh; overflow-y: auto;
        }

        .ex-card {
            text-align: left; padding: 15px; border-bottom: 0.5px solid #EEE;
        }

        /* Navigasyon */
        footer {
            padding: 10px 30px calc(env(safe-area-inset-bottom) + 15px);
            display: flex; justify-content: space-between; align-items: center;
        }

        .nav-btn { font-size: 24px; color: var(--accent); background: none; border: none; font-weight: 700; }
    </style>
</head>
<body>

<header>
    <div class="search-box">
        <input type="text" id="verbSearch" placeholder="Fiil ara..." oninput="searchVerb()">
    </div>
</header>

<main id="flashcard-container"></main>

<footer>
    <button class="nav-btn" onclick="changeCard(-1)">􀄪</button>
    <div id="counter">1 / --</div>
    <button class="nav-btn" onclick="changeCard(1)">􀄫</button>
</footer>

<div id="exOverlay" onclick="toggleExamples(false)">
    <div class="ex-sheet" onclick="event.stopPropagation()">
        <h3 style="margin-top:0">Örnekler</h3>
        <div id="exContent"></div>
        <button class="ex-toggle" style="margin-top:20px" onclick="toggleExamples(false)">Kapat</button>
    </div>
</div>

<script>
    const SHEET_TSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQdKhRHcoqhnlbBvPiGFSh1bHLQJyhj7bi8geY1a9jtYDke0ph_65uNp_VwubpaqBVvia_LzsTQsurc/pub?output=tsv';

    let verbs = [];
    let currentIdx = 0;
    let currentTenseIdx = 0; // 0: Pres, 1: Indef, 2: Imperat, 3: Futuro

    async function loadData() {
        try {
            const res = await fetch(SHEET_TSV_URL);
            const text = await res.text();
            const rows = text.split(/\r?\n/).slice(1);
            
            verbs = rows.filter(r => r.trim() !== "").map(row => {
                const c = row.split('\t');
                return {
                    es: c[0], tr: c[2],
                    tenses: [
                        { name: "Pres.", forms: (c[3]||"").split(';'), tr: (c[4]||"").split(';') },
                        { name: "Indef.", forms: (c[5]||"").split(';'), tr: (c[6]||"").split(';') },
                        { name: "Imperat.", forms: (c[7]||"").split(';'), tr: (c[8]||"").split(';') },
                        { name: "Futuro", forms: (c[9]||"").split(';'), tr: (c[10]||"").split(';') }
                    ],
                    ex: (c[11] || "").split('#').map(item => {
                        const p = item.split(':');
                        return { t: p[0], es: p[1], tr: p[2] };
                    })
                };
            });
            renderCard();
        } catch (e) { alert("Veri yüklenemedi!"); }
    }

    function renderCard() {
        if (!verbs.length) return;
        const v = verbs[currentIdx];
        const t = v.tenses[currentTenseIdx];
        const pronouns = ["Yo", "Tú", "Él/Ella", "Nos.", "Vos.", "Ellos"];

        let gridHtml = t.forms.map((f, i) => `
            <div class="conj-item">
                <span class="pronoun">${pronouns[i]}</span>
                <span class="form">${f.trim()}</span>
                <span class="form-tr">${(t.tr[i] || "").trim()}</span>
            </div>
        `).join('');

        const html = `
            <div class="flashcard">
                <h1 class="verb-title">${v.es}</h1>
                <div class="verb-tr">${v.tr}</div>
                
                <div class="tense-picker">
                    ${v.tenses.map((tense, i) => `
                        <button class="tense-btn ${i === currentTenseIdx ? 'active' : ''}" 
                                onclick="setTense(${i})">${tense.name}</button>
                    `).join('')}
                </div>

                <div class="conjugation-grid">${gridHtml}</div>
                
                <button class="ex-toggle" onclick="toggleExamples(true)">Örnekleri Göster</button>
            </div>
        `;
        
        document.getElementById('flashcard-container').innerHTML = html;
        document.getElementById('counter').innerText = `${currentIdx + 1} / ${verbs.length}`;
        
        // Örnek içeriğini hazırla
        document.getElementById('exContent').innerHTML = v.ex.map(e => `
            <div class="ex-card">
                <b style="color:var(--accent); font-size:12px">${e.t}</b><br>
                <div style="font-size:17px; margin:5px 0">${e.es}</div>
                <div style="color:var(--gray); font-size:14px">${e.tr}</div>
            </div>
        `).join('');
    }

    function setTense(i) {
        currentTenseIdx = i;
        renderCard();
    }

    function toggleExamples(show) {
        document.getElementById('exOverlay').style.display = show ? 'block' : 'none';
    }

    function changeCard(dir) {
        currentIdx = (currentIdx + dir + verbs.length) % verbs.length;
        renderCard();
    }

    function searchVerb() {
        const q = document.getElementById('verbSearch').value.toLowerCase();
        const found = verbs.findIndex(v => v.es.toLowerCase().includes(q) || v.tr.toLowerCase().includes(q));
        if (found !== -1) { currentIdx = found; renderCard(); }
    }

    loadData();
</script>
</body>
</html>
