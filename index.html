<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>İspanyolca Kartlar</title>
    <style>
        :root {
            --ios-bg: #F2F2F7;
            --ios-card: #FFFFFF;
            --spain-gold: #FF9500;
            --action-blue: #007AFF;
            --past-purple: #5856D6;
            --now-green: #34C759;
            --text-main: #1C1C1E;
            --text-sec: #8E8E93;
        }

        body {
            font-family: -apple-system, system-ui, sans-serif;
            background-color: var(--ios-bg);
            margin: 0; display: flex; flex-direction: column;
            height: 100vh; overflow: hidden; color: var(--text-main);
        }

        header {
            background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            padding: calc(env(safe-area-inset-top) + 10px) 16px 12px;
            border-bottom: 0.5px solid #C6C6C8; z-index: 10;
        }

        .search-box { background: #E3E3E6; border-radius: 10px; padding: 8px 12px; display: flex; }
        #verbSearch { border: none; background: transparent; width: 100%; font-size: 17px; outline: none; }

        main { flex: 1; overflow-y: auto; padding: 16px; padding-bottom: 120px; -webkit-overflow-scrolling: touch; }
        
        .card { background: var(--ios-card); border-radius: 20px; padding: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        .header { text-align: center; margin-bottom: 20px; }
        .header h1 { font-size: 34px; font-weight: 800; margin: 0; }
        .header p { font-size: 18px; color: var(--text-sec); margin: 4px 0; }

        /* Segmented Control Tasarımı */
        .segmented-control {
            display: grid; grid-template-columns: repeat(4, 1fr);
            background: #E3E3E6; border-radius: 10px; padding: 2px; margin-bottom: 20px;
        }
        .segment-btn {
            border: none; background: none; padding: 8px 0; font-size: 12px;
            font-weight: 600; border-radius: 8px; cursor: pointer; color: var(--text-sec);
        }
        .segment-btn.active { background: white; color: var(--text-main); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        .section-label { font-size: 12px; font-weight: 700; color: var(--text-sec); text-transform: uppercase; margin: 15px 0 8px 4px; display: block; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .box { background: #F8F8FA; border: 0.5px solid #E5E5EA; padding: 10px; border-radius: 14px; }
        .p-label { font-size: 9px; color: var(--action-blue); font-weight: 800; text-transform: uppercase; }
        .v-form { font-size: 15px; font-weight: 600; display: block; margin: 1px 0; }
        .v-tr { font-size: 10px; color: var(--text-sec); line-height: 1.2; display: block; }

        .ex-btn {
            background: linear-gradient(135deg, var(--action-blue), var(--past-purple));
            color: white; border: none; padding: 16px; border-radius: 16px;
            width: 100%; font-size: 17px; font-weight: 600; margin-top: 20px;
            box-shadow: 0 4px 12px rgba(0,122,255,0.2);
        }

        #exSheet { position: fixed; inset: 0; background: rgba(0,0,0,0.4); display: none; z-index: 2000; }
        .sheet-content { position: absolute; bottom: 0; left: 0; right: 0; background: white; border-radius: 20px 20px 0 0; padding: 25px 20px calc(env(safe-area-inset-bottom) + 20px); max-height: 75vh; overflow-y: auto; }
        .ex-item { background: #F2F2F7; padding: 14px; border-radius: 14px; margin-bottom: 10px; border-left: 4px solid var(--spain-gold); }

        footer {
            position: fixed; bottom: 0; width: 100%; background: rgba(255,255,255,0.85); backdrop-filter: blur(20px);
            padding: 10px 40px calc(env(safe-area-inset-bottom) + 10px);
            display: flex; justify-content: space-between; align-items: center;
            border-top: 0.5px solid #C6C6C8; box-sizing: border-box;
        }
        .nav-btn { font-size: 30px; color: var(--action-blue); background: none; border: none; padding: 10px; }
    </style>
</head>
<body>

<header>
    <div class="search-box"><input type="text" id="verbSearch" placeholder="Fiil ara..." oninput="searchVerb()"></div>
</header>

<main id="app"></main>

<footer>
    <button class="nav-btn" onclick="changeCard(-1)">􀄪</button>
    <div id="counter">-- / --</div>
    <button class="nav-btn" onclick="changeCard(1)">􀄫</button>
</footer>

<div id="exSheet" onclick="this.style.display='none'">
    <div class="sheet-content" onclick="event.stopPropagation()">
        <h2 style="margin-top:0">Dizi Replikleri</h2>
        <div id="exList"></div>
        <button class="ex-btn" style="background:var(--text-sec)" onclick="document.getElementById('exSheet').style.display='none'">Kapat</button>
    </div>
</div>

<script>
const SHEET_TSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQdKhRHcoqhnlbBvPiGFSh1bHLQJyhj7bi8geY1a9jtYDke0ph_65uNp_VwubpaqBVvia_LzsTQsurc/pub?output=tsv';
let verbs = [], currentIdx = 0, currentTab = 'Pres'; // Varsayılan sekme
const pronouns = ["Yo", "Tú", "Él/Ella", "Nos.", "Vos.", "Ellos"];

async function loadData() {
    try {
        const res = await fetch(SHEET_TSV_URL);
        const text = await res.text();
        const rows = text.split(/\r?\n/).slice(1);
        verbs = rows.filter(r => r.trim() !== "").map(row => {
            const c = row.split('\t');
            return {
